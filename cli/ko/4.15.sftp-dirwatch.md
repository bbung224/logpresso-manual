## 4.15. SFTP 디렉터리 로그 파일 수집 설정


SFTP 디렉토리 와치 (sftp-dirwatch) 로거는 SFTP를 통해 원격지에서 롤링되지 않는 텍스트 로그 파일을 일정 주기마다 수집하려고 할 때 사용합니다. 가령 일자별 혹은 시간대별로 순차 생성되는 로그 파일을 수집할 때 사용합니다. SFTP 디렉토리 와치 로거는 아래와 같은 설정을 입력받습니다:

* [필수] SSH 프로파일: SSH 접속 설정 프로파일의 이름을 입력합니다. (SSH 연동 설정 바로가기)
* [필수] 디렉터리 경로: 로그 파일이 위치하는 파일시스템 경로를 입력합니다.
* [필수] 파일이름 정규표현식 패턴: 디렉터리 경로에 존재하는 파일 중 이름이 정규표현식 패턴에 일치하는 경우에만 수집합니다. 정규표현식 그룹을 쓰는 경우 파일 이름에서 날짜 문자열을 추출합니다.
* [선택] 날짜 추출 정규표현식 패턴: 로그에서 날짜 문자열을 추출합니다. 정규표현식 그룹으로 묶인 모든 부분을 이어붙여서 하나의 날짜 문자열을 만들어냅니다. 파일이름 정규표현식의 그룹으로 추출된 날짜문자열은 가장 앞 부분에 위치합니다.
* [선택] 날짜 파싱 포맷: 날짜 문자열을 파싱하는데 사용할 날짜 포맷을 설정합니다. (예: yyyy-MM-dd HH:mm:ss)
* [선택] 로그 시작 정규식:  로그의 시작 부분을 인식하는 정규표현식을 지정합니다. 멀티라인 로그의 경우에 사용되며, 지정하지 않으면 줄 단위로 읽어들입니다.
* [선택] 로그 끝 정규식:  로그의 끝 부분을 인식하는 정규표현식을 지정합니다. 멀티라인 로그의 경우에 사용되며, 지정하지 않으면 줄 단위로 읽어들입니다.
* [선택] 문자집합: 문자집합 코드를 입력합니다. 기본값은 utf-8입니다.

여러 개의 파일이 수집 대상인 경우, 파일의 절대 경로를 사전순으로 정렬하여 순서대로 읽어들입니다. 이하에서는 여러가지 사용 예를 살펴보도록 하겠습니다.

예시 1) /var/log/examples 디렉터리에 example.log.yyyy-MM-dd-HH 로그 파일이 순차 생성되는 경우

~~~
	0;20130615 141618;192.168.0.10;E002;20130615 141618;192.168.0.11;
~~~

* 디렉터리 경로: /var/log/examples
* 파일이름 정규표현식 패턴: example\.log.*
* 날짜 추출 정규표현식 패턴: `^\d+;(\d{8} \d{6});`
* 날짜 파싱 포맷: yyyyMMdd HHmmss

예시 2) /logdata/c6509 디렉터리에 c6509.log.yyyyMMdd 로그 파일이 쌓이는 경우

~~~
	May 01 23:59:59: %LINK-SP-3-UPDOWN: Interface GigabitEthernet8/15, changed state to down
~~~

* 디렉터리 경로: /logdata/c6509
* 파일이름 정규표현식 패턴: `c6509\.log\.(\d{8})`
* 날짜 추출 정규표현식 패턴: `^[^ ]\* \d{2} (\d{2}):(\d{2}):(\d{2})`
* 날짜 파싱 포맷: yyyyMMddHHmmss
 (파일이름 정규표현식으로 추출된 yyyyMMdd 그룹 1개와 날짜 추출 정규표현식에서 추출된 HH, mm, ss 그룹 3개가 하나로 병합되어 파싱됩니다.)


